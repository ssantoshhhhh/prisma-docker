# Project Overview: Task Manager API

This document provides a detailed explanation of the **Task Manager** project. It covers the folder structure, purpose of each file, technology stack, and how to run the application.

## 1. Project Description

This is a **NestJS** backend application for managing tasks and notes.

- **Authentication**: Users register/login to receive a JWT (JSON Web Token).
- **Authorization**: Role-based access control (Admin vs User) using Guards and Decorators.
- **Database**: Stores data in PostgreSQL using Prisma ORM.

## 2. Technology Stack

- **Framework**: [NestJS](https://nestjs.com/) (Node.js)
- **Language**: TypeScript
- **Database**: PostgreSQL
- **ORM**: [Prisma](https://www.prisma.io/)
- **Auth**: Passport (Strategies), JWT
- **Containerization**: Docker

---

## 3. Directory Structure: `src/` (Source Code)

The `src` folder contains the application logic.

### 3.1 Root Files in `src/`

- **`main.ts`**: The entry point. It creates the NestJS app, sets up global validation pipes, and starts the server (usually on port 3000).
- **`app.module.ts`**: The root module. It bundles all feature modules (`AuthModule`, `UsersModule`, etc.) together.
- **`app.controller.ts` & `app.service.ts`**: Basic health check endpoints (e.g., "Hello World").

### 3.2 `src/auth/` (Authentication & Security)

Handles login, registration, and protecting routes.

- **`auth.controller.ts`**: Defines endpoints like `POST /auth/login` and `POST /auth/register`.
- **`auth.service.ts`**: Logic for verifying passwords (using bcrypt) and generating JWTs.
- **`auth.module.ts`**: Configures the JWT library and imports the Users module.
- **`dto/`**: Data Transfer Objects (validation schemas).
  - `login.dto.ts`: Validates email/password for login.
  - `register.dto.ts`: Validates name/email/password for sign-up.
- **`strategy/`**:
  - `jwt.strategy.ts`: Defines how to validate the "Bearer Token" sent in headers. It extracts the `userId` from the token so other endpoints know who is making the request.
- **`guards/`**:
  - `roles.guard.ts`: Checks if the user has the required role (e.g., ADMIN) to access a route. Use with `@Roles()`.
- **`decorators/`**:
  - `roles.decorator.ts`: Custom decorator `@Roles('ADMIN')` to attach metadata to route handlers.

### 3.3 `src/users/` (User Management)

Manages user profiles and data.

- **`users.controller.ts`**: Endpoints for users (e.g., `GET /users/profile`).
- **`users.service.ts`**: Database queries to find users by email or ID.
- **`users.module.ts`**: Bundles the controller and service.

### 3.4 `src/tasks/` (Task Management)

CRUD operations for tasks.

- **`tasks.controller.ts`**: Endpoints for `GET /tasks`, `POST /tasks`, `PATCH /tasks/:id`, etc.
- **`tasks.service.ts`**: Business logic. Calls Prisma to create/read/update/delete tasks.
- **`tasks.module.ts`**: Dependencies for tasks.
- **`dto/`**:
  - `create-task.dto.ts`: Shape of data required to create a task (title, description).
  - `update-task.dto.ts`: Shape of data for updates (allows partial fields).
  - `query-tasks.dto.ts`: Query parameters for filtering (e.g., `?status=OPEN`).

### 3.5 `src/notes/` (Note Management)

Similar to Tasks, but for Notes.

- **`notes.controller.ts`**, **`notes.service.ts`**: Logic for modifying notes.
- **`dto/`**: `create-note.dto.ts`, `update-note.dto.ts`.

### 3.6 `src/prisma/` (Database Layer)

- **`prisma.service.ts`**: Extends the `PrismaClient`. This class is injected into other services (like `TasksService`) to give them access to `this.prisma.task.findMany()`.
- **`prisma.module.ts`**: Exports `PrismaService` globally or to specific modules.

---

## 4. Other Key Directories

### `prisma/` (Schema)

- **`schema.prisma`**: Defines your database tables (`User`, `Task`, `Note`). Modifying this requires running a migration.
- **`migrations/`**: SQL files generated by Prisma to apply changes to the DB.

### `test/`

- Contains configuration and files for End-to-End (e2e) testing.

## 5. Typical Workflow for Adding a Feature

1.  **Update Schema**: Edit `prisma/schema.prisma` to add a new model or field.
2.  **Migrate**: Run `npx prisma migrate dev`.
3.  **Create Module**: Run `nest g resource <feature_name>`.
4.  **Implement Logic**: Edit the new `service.ts` and `controller.ts` files in `src/<feature_name>`.

## 6. Commands (Reference)

- `npm run start:dev`: Run app.
- `npx prisma studio`: specific database GUI.
- `docker-compose up`: Start DB and App containers.
